// eln
protocol
init;close; _switch1; (open;close;_switch1)*;settlement;(open;close;_switch2)*;strike;(open;close;_switch3)*;_stock_terminate
+
init;close;_switch1; (open;close;_switch1)*;settlement;(open;close;_switch2)*;mature;_cash_terminate;;

property
!s & !m & !lt_60;

rule
on init do { _data.date = 0 };
on close when true do {
     _data.price = _event.data.price; 
     _data.date = _data.date + 1; };

//on close do raise _date { } 

on _switch1 when true do s { if ( _data.date == 2 ) { __raiseEvent("settlement");};};
on _switch2 when true do m { if (_data.date == 4 ) { __raiseEvent("mature");}; };
on _switch2 when true do { if ( _data.date == 3 & _data.price < 60 ) { __raiseEvent("strike");}; };
on _switch3 when true do { if (_data.date == 4) {__raiseEvent("_stock_terminate");};};
//on _switch when  d2 & lt_60 { _data.price <= 60 } do d2 & lt_60; 
//on _switch when  d2 & !lt_60 { _data.price > 60 } do d2 & !lt_60; 

on ^_switch1 preserve s;
on ^_switch2 preserve m;
on ^_switch2 preserve lt_60;
on stike when m do false;
on strike when !lt_60 do false;
on mature when lt_60 do false;
on mature when !m do false;
//on _cash_terminate when lt_60 do false;
//on _cash_terminate when !m do false;
//on _stock_terminate when !lt_60 do false;
//on _stock_terminate when m do false;
//on _switch when !d3 & d4 do false;

