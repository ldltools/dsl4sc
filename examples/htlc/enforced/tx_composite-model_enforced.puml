@startuml
' left to right direction
' hide empty description


state "q2" as q2
' q2 : !_tx1_state_0,!_tx1_state_1,!_tx2_state_0,!_tx2_state_1,!tx1_done,!tx2_done
' q2 : tx1_state=0,tx2_state=0,!tx1_done,!tx2_done
q2 : tx1_state=0,tx2_state=0,tx1_done=F,tx2_done=F

state "q4" as q4
' q4 : !_tx1_state_0,!_tx1_state_1,!_tx2_state_0,!_tx2_state_1,!tx1_done,!tx2_done
' q4 : tx1_state=0,tx2_state=0,!tx1_done,!tx2_done
q4 : 0,0,F,F

state "q5" as q5
' q5 : _tx1_state_0,_tx1_state_1,!_tx2_state_0,!_tx2_state_1,!tx1_done,!tx2_done
' q5 : tx1_state=3,tx2_state=0,!tx1_done,!tx2_done
q5 : 3,0,F,F

state "q6" as q6
' q6 : _tx1_state_0,!_tx1_state_1,!_tx2_state_0,!_tx2_state_1,tx1_done,!tx2_done
' q6 : tx1_state=1,tx2_state=0,tx1_done,!tx2_done
q6 : 1,0,T,F

state "q7" as q7
' q7 : !_tx1_state_0,_tx1_state_1,!_tx2_state_0,_tx2_state_1,!tx1_done,!tx2_done
' q7 : !_tx1_state_0,_tx1_state_1,!_tx2_state_0,!_tx2_state_1,!tx1_done,!tx2_done
' q7 : tx1_state=2,tx2_state=2,!tx1_done,!tx2_done
' q7 : tx1_state=2,tx2_state=0,!tx1_done,!tx2_done
q7 : 2,2,F,F
q7 : 2,0,F,F

state "q8" as q8
' q8 : _tx1_state_0,!_tx1_state_1,!_tx2_state_0,!_tx2_state_1,tx1_done,!tx2_done
' q8 : tx1_state=1,tx2_state=0,tx1_done,!tx2_done
q8 : 1,0,T,F

state "last" as q9
' q9 : !_tx1_state_0,!_tx2_state_0,!tx1_done,!tx2_done
' q9 : !_tx1_state_0,_tx2_state_0,_tx2_state_1,!tx1_done,!tx2_done
' q9 : _tx1_state_0,_tx1_state_1,!_tx2_state_0,!tx1_done,!tx2_done
' q9 : _tx1_state_0,_tx1_state_1,_tx2_state_0,_tx2_state_1,!tx1_done,!tx2_done
' q9 : _tx1_state_0,!_tx1_state_1,_tx2_state_0,!_tx2_state_1,tx1_done,tx2_done

state "q10" as q10
' q10 : _tx1_state_0,!_tx1_state_1,_tx2_state_0,!_tx2_state_1,tx1_done,tx2_done
' q10 : tx1_state=1,tx2_state=1,tx1_done,tx2_done
q10 : 1,1,T,T

state "q11" as q11
' q11 : _tx1_state_0,!_tx1_state_1,_tx2_state_0,_tx2_state_1,tx1_done,!tx2_done
' q11 : tx1_state=1,tx2_state=3,tx1_done,!tx2_done
q11 : 1,3,T,F


[*] -left-> q2

q2 -down-> q4 : tx1
q4 -right-> q6 : tx1_end
q6 -right-> q8 : tx2
q8 --> q10 : tx2_end

q4 -down-> q5 : tx1_err
q5 --> q7 : rollback
q8 -down-> q11 : tx2_err
q11 --> q7 : rollback

q7 -right-> q9
'q7 --> q9
'q7 --> q9
'q7 --> q9
q10 --> q9

q9 -right-> [*]


@enduml
