@startuml
' left to right direction
' hide empty description


state "q2" as q2
' q2 : !_tx1_state_0,!_tx1_state_1,!_tx2_state_0,!_tx2_state_1
q2 : tx1_state=0,tx2_state=0
'q2 : 0,0

state "q4" as q4
' q4 : !_tx1_state_0,!_tx1_state_1,!_tx2_state_0,!_tx2_state_1
' q4 : tx1_state=0,tx2_state=0
q4 : 0,0

state "q5" as q5
' q5 : _tx1_state_0,_tx1_state_1,!_tx2_state_0,!_tx2_state_1
' q5 : tx1_state=3,tx2_state=0
q5 : 3,0

state "q6" as q6
' q6 : _tx1_state_0,!_tx1_state_1,!_tx2_state_0,!_tx2_state_1
' q6 : tx1_state=1,tx2_state=0
q6 : 1,0

state "q7" as q7
' q7 : !_tx1_state_0,_tx1_state_1,!_tx2_state_0,_tx2_state_1
' q7 : !_tx1_state_0,_tx1_state_1,!_tx2_state_0,!_tx2_state_1
' q7 : tx1_state=1,tx2_state=1
' q7 : tx1_state=2,tx2_state=2
' q7 : tx1_state=2,tx2_state=0
q7 : 1,1
q7 : 2,2
q7 : 2,0

state "q8" as q8
' q8 : _tx1_state_0,!_tx1_state_1,!_tx2_state_0,!_tx2_state_1
' q8 : tx1_state=1,tx2_state=0
q8 : 1,0

state "last" as q9
' q9 : true

state "q10" as q10
' q10 : _tx1_state_0,!_tx1_state_1,_tx2_state_0,_tx2_state_1
' q10 : tx1_state=1,tx2_state=3
q10 : 1,3


[*] -left-> q2

q2 -down-> q4 : tx1
q4 -right-> q6 : tx1_end
q6 -right-> q8 : tx2
q8 --> q7 : tx2_end

q4 -down-> q5 : tx1_err
q5 --> q7 : rollback
q8 -down-> q10 : tx2_err
q10 --> q7 : rollback

q7 -right-> q9
' q7 -right-> q9 : Îµ
q9 -right-> [*]

@enduml
